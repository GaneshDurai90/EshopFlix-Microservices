@model IEnumerable<eShopFlix.Web.Models.ProductModel>
@{
    ViewData["Title"] = "Home";
}

<div class="d-flex align-items-center justify-content-between mb-3">
    <h2 class="mb-0">Explore Products</h2>
    <form class="d-flex" role="search" onsubmit="return false;">
        <input class="form-control" type="search" placeholder="Search products..." aria-label="Search" id="product-search" />
    </form>
</div>

@if (Model != null && Model.Any())
{
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3" id="product-grid">
        @foreach (var product in Model)
        {
            <div class="col">
                <div class="card h-100 shadow-sm product-card" data-name="@product.Name">
                    <img class="card-img-top object-fit-cover" style="height:180px" src="@product.ImageUrl" alt="@product.Name">
                    <div class="card-body d-flex flex-column">
                        <h6 class="card-title mb-1 text-truncate" title="@product.Name">@product.Name</h6>
                        <p class="card-text small text-muted flex-grow-1">@product.Description</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-semibold">₹@product.UnitPrice.ToString("##.#")</span>
                            @if (CurrentUser != null)
                            {
                                <button onclick="addToCart('@product.ProductId','@product.Name','@product.UnitPrice', 1)" class="btn btn-sm btn-primary">Add To Cart</button>
                            }
                            else
                            {
                                <a href="/Account/Login?returnUrl=/" class="btn btn-sm btn-primary">Add to Cart</a>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="alert alert-info">No products found.</div>
}

@section Scripts{
<script>
    const search = document.getElementById('product-search');
    const grid = document.getElementById('product-grid');
    if (search && grid) {
        search.addEventListener('input', function(){
            const q = this.value.toLowerCase();
            grid.querySelectorAll('.product-card').forEach(card => {
                const name = (card.getAttribute('data-name')||'').toLowerCase();
                card.parentElement.style.display = name.includes(q) ? '' : 'none';
            });
        });
    }
</script>
}

